"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ramda_1 = require("ramda");
const clients_1 = require("../../../clients");
const utils_1 = require("../utils");
const castValue = value => {
    let parsedValue;
    try {
        parsedValue = JSON.parse(value);
    }
    catch (err) {
        parsedValue = value;
    }
    const numberCast = Number(value);
    return isNaN(numberCast) ? parsedValue : numberCast;
};
const transformCommandsToObj = commandSettings => {
    const k = [];
    const v = [];
    for (const [idx, val] of commandSettings.entries()) {
        const realValue = castValue(val);
        if (idx % 2) {
            v.push(realValue);
        }
        else {
            k.push(realValue);
        }
    }
    return ramda_1.zipObj(k, v);
};
exports.default = async (app, _, ___, options) => {
    const commandSettings = transformCommandsToObj(utils_1.parseArgs(options._));
    const newSettingsJson = await clients_1.apps
        .getAppSettings(app)
        .then(ramda_1.merge(ramda_1.__, commandSettings))
        .then(newSettings => JSON.stringify(newSettings, null, 2));
    await clients_1.apps.saveAppSettings(app, newSettingsJson);
    console.log(newSettingsJson);
};
